# MUNE 애플리케이션 보안 규칙 가이드

## 📋 개요
이 문서는 MUNE 애플리케이션의 Firebase Firestore 보안 규칙에 대한 상세한 설명을 제공합니다.

## 🔐 보안 규칙 구조

### 1. 헬퍼 함수들

#### `isAuthenticated()`
- 사용자가 로그인되어 있는지 확인
- Firebase Authentication을 통한 인증 상태 검증

#### `isOwner(ownerId)`
- 현재 사용자가 특정 리소스의 소유자인지 확인
- 인증된 사용자의 UID와 소유자 ID 비교

#### `isValidRoomData()`
- 채팅룸 데이터의 유효성 검증
- 필수 필드 존재 여부 및 데이터 타입 검증
- 문자열 길이 제한 (이름: 1-100자, 관리자명: 1-50자, 비밀번호: 4자 이상)

#### `isValidUserData()`
- 사용자 데이터의 유효성 검증
- 필수 필드 존재 여부 및 데이터 타입 검증
- 채팅룸 개수 제한 (0-3개)

#### `isValidMessageData()`
- 메시지 데이터의 유효성 검증
- 메시지 길이 제한 (1-1000자)
- 사용자명 길이 제한 (1-50자)
- 메시지 타입 검증 ('user', 'system', 'admin')

### 2. 컬렉션별 보안 규칙

#### `/users/{userId}` - 사용자 프로필
- **읽기/쓰기**: 본인만 가능
- **생성**: 유효한 사용자 데이터 필요
- **업데이트**: 중요 필드(uid, email, createdAt) 변경 불가

#### `/rooms/{roomId}` - 채팅룸
- **읽기**: 모든 사용자 가능 (참여자 접근을 위해)
- **생성**: 로그인한 사용자만, 본인을 소유자로 설정, 데이터 검증 필요
- **업데이트**: 소유자만 가능, 소유자 정보 변경 불가
- **삭제**: 소유자만 가능

#### `/rooms/{roomId}/messages/{messageId}` - 채팅 메시지
- **읽기**: 모든 사용자 가능
- **생성**: 유효한 메시지 데이터 필요
- **수정/삭제**: 불가 (채팅 무결성 보장)

#### `/polls/{pollId}` - 설문조사
- **읽기**: 모든 사용자 가능
- **쓰기**: 로그인한 사용자만 가능

#### `/polls/{pollId}/votes/{voteId}` - 투표
- **읽기**: 모든 사용자 가능
- **생성**: 모든 사용자 가능 (익명 투표 지원)
- **수정/삭제**: 불가 (투표 조작 방지)

### 3. 레거시 지원

#### `/chatRooms/{roomId}` 및 `/messages/{messageId}`
- 기존 호환성을 위해 유지
- 점진적 제거 예정
- 제한된 권한으로 운영

## 🛡️ 보안 강화 사항

### 1. 데이터 검증
- 모든 입력 데이터의 타입 및 길이 검증
- 필수 필드 존재 여부 확인
- 악성 데이터 입력 방지

### 2. 권한 분리
- 소유자 기반 접근 제어
- 읽기/쓰기 권한 세분화
- 중요 필드 변경 방지

### 3. 무결성 보장
- 메시지 수정/삭제 금지
- 투표 조작 방지
- 채팅룸 소유권 보호

### 4. 리소스 제한
- 채팅룸 개수 제한 (최대 3개)
- 메시지 길이 제한
- 사용자명 길이 제한

## 🚀 배포 방법

1. Firebase Console에서 Firestore Database 접속
2. 규칙 탭으로 이동
3. `firestore.rules` 파일 내용을 복사하여 붙여넣기
4. 규칙 게시

## ⚠️ 주의사항

- 규칙 변경 후 반드시 테스트 진행
- 기존 데이터와의 호환성 확인
- 성능에 미치는 영향 모니터링
- 정기적인 보안 감사 실시

## 🔍 모니터링

Firebase Console에서 다음 항목들을 정기적으로 확인:
- 보안 규칙 위반 로그
- 비정상적인 접근 패턴
- 데이터 사용량 및 요청 수
- 에러 발생 빈도

## 📞 지원

보안 관련 문제나 규칙 수정이 필요한 경우:
- 개발팀에 문의
- 보안 감사 요청
- 긴급 상황 시 즉시 연락
